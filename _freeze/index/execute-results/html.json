{
  "hash": "f0a4e4480788f71394cf76b3c0af58a5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Revisiting the SAFE Framework in the Statcast Era: A Modernized Approach to Evalutating MLB Infield Defense\"\nauthor:\n  - name: Tyler McCord\n    corresponding: true\n    email: tmccord26@amherst.edu\n    affiliations:\n      - Amherst College\nkeywords: Bayesian modeling, Sports analytics, Baseball defense\nabstract: |\n  High resolution tracking data has transformed player evaluation in Major League Baseball (MLB), enabling high-level analysis of player performance. While public analyses on batting and pitching have advanced rapidly, defensive evaluation has been comparatively underdeveloped. The SAFE (Spatially Adjusted Fielding Evaluation) framework, introduced by @jensen_2009, was the first effort in the public sphere to evaluate defense as a continuous space. We revisit the SAFE framework using modern Statcast data with an emphasis on infield defense, a notable struggle for prior defensive metrics. [Placeholder for results]\ndate: last-modified\nbibliography: references.bib\nnumber-sections: true\n---\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.2\n✔ ggplot2   4.0.0     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.1.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(kableExtra)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n\nAttaching package: 'kableExtra'\n\nThe following object is masked from 'package:dplyr':\n\n    group_rows\n```\n\n\n:::\n:::\n\n\n\n## Introduction\n\nThe evaluation of batting and pitching in baseball has been at the forefront of sports analytics for decades, mostly due to their discrete nature and the availability of relevant, quantifiable data.\nIt is relatively simple to measure the outcome of a plate appearance or a pitch, making it easier to develop metrics that accurately reflect player performance in these areas.\nIn contrast, defensive evaluation has lagged behind due to the continuous, spatiotemporal nature of fielding. \n\nStill, Major League Baseball (MLB) organizations are faced with important decisions regarding defense, such as positioning players, making defensive substitutions, and evaluating trade-offs between offensive and defensive abilities.\nAt the end of each season, MLB issues Gold Glove awards to the best defenders at each position, highlighting the importance of defense in the game.\n\nBefore the advent of high-resolution player tracking data, teams relied on simple defensive metrics such as fielding percentage, which calculates the percentage of plays a fielder successfully makes, and errors, which count the number of plays that the player does not make that the average fielder would.\nHowever, errors are prone to subjectivity, as they depend primarily on the official scorer's judgement.\nThese metrics also fail to capture the full scope of a player's defensive contributions, as they do not account for factors such as range, positioning, and the difficulty of plays made.\n\nStatisticians have tried to find ways to quantify the nuances of defense.\nIn 2003, Mitchel Lichtman introduced the Ultimate Zone Rating (UZR) metric, which attempted to evaluate defense by dividing the field into discrete zones and assigning run values to plays made or not made within those zones (@uzr_fangraphs).\nThis run-based approach allowed statisticians to understand the stakes of each defensive play.\n\nIn 2009, @jensen_2009 introduced the SAFE (Spatially Adjusted Fielding Evaluation) framework, which built upon UZR by using a hierarchical Bayesian model to evaluate defense as a continuous surface.\nThe SAFE framework uses estimates of player location, ball location, and ball velocity to model the probability of a fielder making a play on a batted ball, allowing for a more nuanced evaluation of defensive performance.\nThe model combines the probability of a made play with the run consequences of that play to estimate the overall defensive contribution of a player in terms of runs saved or allowed.\nThe hierarchical Bayesian structure also allows for the sharing of information across players and positions, improving estimates for players with limited data.\nHowever, this model is limited by the accuracy and reliability of the underlying data used to estimate player and ball locations.\nThese data, provided by Baseball Info Solutions, used hand-annotated video footage to estimate ball location and velocity.\nEven then, the starting location of the fielder at a given position was estimated by the authors by using the average location of balls caught by that position.\n\nNotably, the results of @jensen_2009 showed that the autocorrelation of defensive metrics from year to year was quite low for infielders. \nThis shortcoming suggests that the original SAFE model performed poorly in evaluating infield defense, relative to outfield defense.\n\nSince the publication of the SAFE framework, MLB has introduced Statcast, a high-resolution player tracking system that uses a combination of radar and camera technology to track the movement of players and the ball in real-time (need to find a citation).\nStatcast provides a wealth of data that was previously unavailable, including precise measurements of player and ball locations, velocities, and trajectories.\nThis data has the potential to revolutionize defensive evaluation in baseball, allowing for more accurate and reliable estimates of defensive performance.\n\nIn this paper, we modernize the original SAFE framework for infielders using three years Statcast data (2023-2025).\nWe propose three models:\n\n1. A reproduction of the original SAFE model using Statcast data.\n2. A semi-reproduction of the original SAFE model using updated player-specific positioning data.\n3. An improved model that incorporates player-specific positioning data and additional covariates to better capture the nuances of infield defense.\n\nWe compare the results of these models to assess the impact of using high-resolution tracking data and updated positioning information on defensive evaluation.\nWe also evaluate the year-to-year reliability of our models to assess their effectiveness in capturing true defensive ability.\n\n## Data\n\nOur evaluation of infield defense is based on Statcast data from 2023-2025.\nAlthough Statcast data has been publicly available since 2015, we focus on the most recent three years because the infield \"shift\", a defensive strategy where infielders position themselves in extreme positions based on the batter's hitting tendencies, was banned following the 2022 season.\nWe believe that narrowing the frame of our analysis to non-shifted seasons will yield more accurate estimates due to more consistent estimates for fielder locations.\nWe obtain data on batted balls through the `baseballr` package in R, which provides a convenient interface for scraping Statcast data from MLB's public API.\nThe result is an .Rds file for each year of interest where each observation corresponds to a single batted ball in play (BIP) event.\nFurther, as an extension of the original SAFE framework, we extract information on individual player positioning before each pitch by using the \"Fielder Positioning\" page on Baseball Savant (@savant_positioning). \nThe location for each infielder on a given play is not publicly available.\nHowever, Baseball Savant provides average positioning data for each player at each position based on all batted balls successfully fielded by that position.\nWe extract these data by downloading the relevant CSV files from the Baseball Savant website. \n\nFor each batted ball in play, we extract the relevant information needed to identify the fielder responsible for making a play, the location and velocity of the batted ball, and the outcome of the play.\n\nUsing these data, we derive the following factors for each batted ball:\n\n- **successful_play**: A binary indicator of whether the fielder successfully made a play on the batted ball (1 = successful play, 0 = unsuccessful play). For ground balls, this is defined as whether the fielder was able to field the ball and record at least one out. For fly balls/line drives, this is defined as whether the fielder was able to catch the ball before it touched the ground.\n- **play_made_by**: The position (1B, 2B, SS, 3B) of the fielder who made the play on the batted ball (Other, if play is not successful or play is made by another position).\n- **location_x, location_y**: The (x, y) coordinates of the batted ball when it reaches the fielder's location, measured in feet from home plate. The origin (0, 0) is at home plate, with the positive x-axis extending towards first base and the positive y-axis extending towards second base.\n- **spray_angle**: Derived from the (x, y) coordinates, this angle represents the direction of the batted ball relative to home plate, measured in degrees. The first base foul line is 45 degrees, second base is 0 degrees, and the third base foul line is -45 degrees. \n- **launch_velocity**: The velocity at which a ball is hit off the bat, measured in miles per hour (mph).\n- **out_{pos}**: A binary indicator for each infielder position (1B, 2B, SS, 3B) indicating whether or not the player at that position recorded a successful play on the batted ball.\n\nThe resulting dataset contains 16 variables from 339,230 batted balls in play in fair territory from the 2023-2025 seasons. \n\n\n\n::: {#tbl-bip-summary .cell tbl-cap='Summary statistics for batted balls in play from 2023-2025 seasons.'}\n\n```{.r .cell-code .hidden}\nbip_full <- read_rds(\"statcast_data/bip_clean.rds\")\n\nbip_full |>\n  group_by(game_year) |>\n  summarise(\n    total_bip = n(),\n    ground_balls = sum(bb_type == \"ground_ball\", na.rm = TRUE),\n    line_drives = sum(bb_type == \"line_drive\", na.rm = TRUE),\n    fly_balls = sum(bb_type == \"fly_ball\", na.rm = TRUE),\n    pop_ups = sum(bb_type == \"popup\", na.rm = TRUE),\n    outs_1b = sum(out_1b == 1, na.rm = TRUE),\n    outs_2b = sum(out_2b == 1, na.rm = TRUE),\n    outs_ss = sum(out_ss == 1, na.rm = TRUE),\n    outs_3b = sum(out_3b == 1, na.rm = TRUE)\n  ) |>\n  ungroup() |>\n  kable(\n    booktabs = TRUE,\n    col.names = c(\"Year\", \"Total BIP\", \"Ground Balls\", \"Line Drives\", \"Fly Balls\", \"Pop Ups\", \"Outs at 1B\", \"Outs at 2B\", \"Outs at SS\", \"Outs at 3B\"),\n    )\n```\n\n::: {.cell-output-display}\n\n\n| Year| Total BIP| Ground Balls| Line Drives| Fly Balls| Pop Ups| Outs at 1B| Outs at 2B| Outs at SS| Outs at 3B|\n|----:|---------:|------------:|-----------:|---------:|-------:|----------:|----------:|----------:|----------:|\n| 2023|    112450|        48421|       27968|     30570|    5491|       4682|      12932|      13592|       9711|\n| 2024|    113080|        48547|       27829|     31037|    5667|       4953|      12978|      13647|       9587|\n| 2025|    113700|        48102|       28367|     31513|    5718|       4805|      13264|      13492|       9431|\n\n\n:::\n:::\n\n\n@tbl-bip-summary shows summary statistics for batted balls in play hit into fair territory from the 2023-2025 seasons.\nThe proportion of batted balls by type and the number of outs recorded at each infield position are consistent across the three seasons.\n\n\n::: {#tbl-continuous-summary .cell tbl-cap='Summary statistics for batted ball variables in the batted ball dataset.'}\n\n```{.r .cell-code .hidden}\ncontinuous_vars <- c(\"launch_speed\", \"spray_angle\", \"location_x\", \"location_y\")\n\nbip_full |>\n  select(continuous_vars) |>\n  pivot_longer(everything(), names_to = \"variable\", values_to = \"value\") |>\n  mutate(variable = factor(variable, levels = continuous_vars,\n                           labels = c(\"Exit Velocity (mph)\", \"Spray Angle (degrees)\", \"Location X (ft)\", \"Location Y (ft)\"))) |>\n  group_by(variable) |>\n  summarize(\n    mean = round(mean(value, na.rm = TRUE), 2),\n    sd = round(sd(value, na.rm = TRUE), 2),\n    min = round(min(value, na.rm = TRUE), 2),\n    max = round(max(value, na.rm = TRUE), 2)\n  ) |>\n  kable(\n    col.names = c(\"Variable\", \"Mean\", \"SD\", \"Min\", \"Max\")\n  )\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Using an external vector in selections was deprecated in tidyselect 1.1.0.\nℹ Please use `all_of()` or `any_of()` instead.\n  # Was:\n  data %>% select(continuous_vars)\n\n  # Now:\n  data %>% select(all_of(continuous_vars))\n\nSee <https://tidyselect.r-lib.org/reference/faq-external-vector.html>.\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n\n|Variable              |   Mean|     SD|     Min|    Max|\n|:---------------------|------:|------:|-------:|------:|\n|Exit Velocity (mph)   |  89.36|  14.38|    5.60| 121.50|\n|Spray Angle (degrees) |  -0.26|  25.74|  -45.00|  45.00|\n|Location X (ft)       |   0.96|  97.95| -308.12| 303.72|\n|Location Y (ft)       | 198.61| 101.33| -111.55| 489.08|\n\n\n:::\n:::\n\n\n\n\n::: {#cell-fig-fielder-positioning .cell}\n\n```{.r .cell-code .hidden}\nsafe_positioning <- read_rds(\"statcast_data/player_positioning/safe_positioning.rds\")\n\nggplot() +\n  geom_point(data = bip_full |> filter(play_made_by != \"Other\"), aes(x = location_x, y = location_y), alpha = 0.1) +\n  geom_point(data = safe_positioning, aes(x = pos_x, y = pos_y), color = \"red\", size = 3) +\n  facet_wrap(~ play_made_by) +\n  theme_classic() +\n  theme(\n    axis.title.x = element_blank(),\n    axis.title.y = element_blank()\n  )\n```\n\n::: {.cell-output-display}\n![Average fielder positioning for infielders (1B, 2B, SS, 3B) based on batted balls successfully fielded from 2023-2025 seasons.](index_files/figure-html/fig-fielder-positioning-1.png){#fig-fielder-positioning width=672}\n:::\n:::\n\n\n[Might get moved to a Methods section] Following the process outlined in @jensen_2009, we derive the starting location of the fielder at each position by calculating the average (x, y) coordinates of all batted balls successfully fielded by that position. @fig-fielder-positioning shows the calculated average fielder positioning for each infield position based on batted balls successfully fielded from the 2023-2025 seasons.\n\n## Methods\n\nTo describe the modernization of the SAFE framework, we start with a technical overview of the original model from @jensen_2009.\n\nThe first step is to estimate the probability that a fielder makes a successful play on a batted ball for each combination of year, position, and batted ball type (ground ball, line drive, fly ball/pop up).\nWithin a given position, we only consider plays in which the fielder at that position either made a successful play on the batted ball or nobody made a successful play on the batted ball.\nThis follows with the original SAFE framework, which only considers plays that the fielder at the given position had a chance to make.\nIt would be unfair to also consider plays in which another fielder made the play, as this would penalize the fielder at the given position for plays they had no chance to make.\nWe also only consider batted balls hit into fair territory within 250 feet of the player's starting position, as these are the plays that the fielder at that position is most likely to have a chance to make.\nThis limits our model to only plays that a player at that position would be eligible for. \n\nThis general probability model estimates the probability that a given play will be successful based on various covariates that describe the nature of the batted ball and the fielder's position.\nIn order to capture the defensive abilities of each fielder, we use a hierarchical structure, in which we fit individual coefficients for each fielder at each position.\n\n\n### Fly Balls and Line Drives\n\nFor fly balls and line drives, a successful play is defined as a play in which the fielder catches the ball before it touches the ground.\nThen, we can define each batted ball $j$ as a Bernoulli trial with outcome $S_{ij} = 1$ if player $i$ made a successful play and $S_{ij} = 0$ otherwise.\nThen, we define:\n$$\nS_{ij} = \\text{Bernoulli}(p_{ij})\n$$\nwhere $p_{ij}$ is the probability that fielder $i$ makes a successful play on batted ball $j$.\n\nWe model this probability as a function of the distance that player $i$ must travel to reach the location of batted ball $j$ ($D_{ij}$), the velocity of the batted ball ($V_{ij}$), and an indicator for the direction that the fielder must travel to make the play ($F_{ij} = 1$ for forward, $F_{ij} = 0$ for backward):\n\n$$\np_{ij} = \\Phi(\\beta_{i0} + \\beta_{i1} D_{ij} + \\beta_{i2} D_{ij} F_{ij} + \\beta_{i3} D_{ij} V_{ij} + \\beta_{i4} D_{ij} V_{ij} F_{ij})\n$$\n\nwhere $\\Phi$ is the standard normal cumulative distribution function (CDF) and $\\beta_{i0}, \\beta_{i1}, \\beta_{i2}, \\beta_{i3}, \\beta_{i4}$ are player-specific coefficients that capture the effect of each covariate on the probability of making a successful play.\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# --------------------- FLY BALL/POP UP MODEL FITTING ---------------------\nbip_fb_pu <- bip_full |>\n  filter(bb_type %in% c(\"fly_ball\", \"popup\"))\n\nfit_position_model <- function(bip_data, year, positioning_data, position) {\n  # Filter positioning data for the relevant year and position\n  pos <- positioning_data |>\n    filter(play_made_by == !!position)\n  \n  # Merge position coordinates onto play data, filter to year, and compute features\n  play_data <- bip_data |>\n    filter(\n      game_year == year,\n      (successful_play == 1 & play_made_by == position) | (successful_play == 0)\n    ) |>\n    mutate(\n      pos_x = pos$pos_x,\n      pos_y = pos$pos_y,\n      d_pos = sqrt(pos_x^2 + pos_y^2),\n      d_ball = sqrt(location_x^2 + location_y^2),\n      dist_to_ball = sqrt((location_x - pos_x)^2 + (location_y - pos_y)^2),\n      forward = ifelse(d_pos > d_ball, 1, 0),\n      player_id = case_when(\n        position == \"1B\" ~ fielder_3,\n        position == \"2B\" ~ fielder_4,\n        position == \"3B\" ~ fielder_5,\n        position == \"SS\" ~ fielder_6,\n        TRUE ~ NA_character_\n      )\n    ) |>\n    filter(dist_to_ball <= 250)\n\n  # Create the outcome variable name dynamically\n  outcome_var <- paste0(\"out_\", str_to_lower(position))\n  formula_str <- paste0(\n    outcome_var, \" ~ dist_to_ball + dist_to_ball:forward + dist_to_ball:launch_speed + dist_to_ball:launch_speed:forward\"\n  )\n\n  # Pre bayesian model \n  model <- glm(\n    formula = as.formula(formula_str),\n    data = play_data,\n    family = binomial(link = \"probit\")\n  )\n  \n  return(model)\n}\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# -------------------------- LINE DRIVE MODEL FITTING --------------------------\nbip_fb_pu <- bip_full |>\n  filter(bb_type == \"line_drive\")\n\nfit_position_model <- function(bip_data, year, positioning_data, position) {\n  # Filter positioning data for the relevant year and position\n  pos <- positioning_data |>\n    filter(play_made_by == !!position)\n  \n  if (nrow(pos) != 1) {\n    stop(\"Positioning data must have exactly one row for each year/position combination\")\n  }\n  \n  # Merge position coordinates onto play data, filter to year, and compute features\n  play_data <- bip_data |>\n    filter(\n      game_year == year,\n      (successful_play == 1 & play_made_by == position) | (successful_play == 0)\n    ) |>\n    mutate(\n      pos_x = pos$pos_x,\n      pos_y = pos$pos_y,\n      d_pos = sqrt(pos_x^2 + pos_y^2),\n      d_ball = sqrt(location_x^2 + location_y^2),\n      dist_to_ball = sqrt((location_x - pos_x)^2 + (location_y - pos_y)^2),\n      forward = ifelse(d_pos > d_ball, 1, 0),\n      player_id = case_when(\n        position == \"1B\" ~ fielder_3,\n        position == \"2B\" ~ fielder_4,\n        position == \"3B\" ~ fielder_5,\n        position == \"SS\" ~ fielder_6,\n        TRUE ~ NA_character_\n      )\n    ) |>\n    filter(dist_to_ball <= 250)\n\n  # Create the outcome variable name dynamically\n  outcome_var <- paste0(\"out_\", str_to_lower(position))\n  formula_str <- paste0(\n    outcome_var, \" ~ dist_to_ball + dist_to_ball:forward + dist_to_ball:launch_speed + dist_to_ball:launch_speed:forward\"\n  )\n\n  # Pre bayesian model \n  model <- glm(\n    formula = as.formula(formula_str),\n    data = play_data,\n    family = binomial(link = \"probit\")\n  )\n  \n  return(model)\n}\n```\n:::\n\n\n\n## Ground Balls\n\nHowever, the more common batted ball that infielders must handle are ground balls.\nA successful play on a ground ball is one in which the fielder records at least one out on the play. \nWe define $S_{ij}$ in the same way as for fly balls and line drives, and model it similarly as a Bernoulli trial with probability $p_{ij}$.\n\nThe authors model this probability using the velocity of the batted ball ($V_{ij}$), the angle ($\\theta_{ij}$) between the fielder's starting position and the location of the batted ball, and an indicator for whether the fielder must move left or right to make the play ($L_{ij} = 1$ for left, $L_{ij} = 0$ for right):\n\n$$\np_{ij} = \\Phi(\\beta_{i0} + \\beta_{i1} \\theta_{ij} + \\beta_{i2} \\theta_{ij} L_{ij} + \\beta_{i3} \\theta_{ij} V_{ij} + \\beta_{i4} \\theta_{ij} V_{ij} L_{ij})\n$$\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# -------------------------- GROUND BALL MODEL FITTING --------------------------\n\nbip_gb <- bip_full |>\n  filter(bb_type == \"ground_ball\")\n\nfit_position_model_gb <- function(bip_data, year, positioning_data, position) {\n  \n  # Filter positioning data for the relevant year and position\n  pos <- positioning_data |>\n    filter(play_made_by == !!position)\n  \n  if (nrow(pos) != 1) {\n    stop(\"Positioning data must have exactly one row for each year/position combination\")\n  }\n  \n  # Merge position coordinates onto play data, filter to year, and compute features\n  play_data <- bip_data |>\n    filter(\n      game_year == year,\n      (successful_play == 1 & play_made_by == position) | (successful_play == 0)\n    ) |>\n    mutate(\n      pos_x = pos$pos_x,\n      pos_y = pos$pos_y,\n      pos_angle = pos$pos_angle,\n      theta = abs(pos_angle - spray_angle),\n      move_left = ifelse(spray_angle < pos_angle, 1, 0),\n      player_id = case_when(\n        position == \"1B\" ~ fielder_3,\n        position == \"2B\" ~ fielder_4,\n        position == \"3B\" ~ fielder_5,\n        position == \"SS\" ~ fielder_6,\n        TRUE ~ NA_character_\n      )\n    )\n  \n  # Create the outcome variable name dynamically\n  outcome_var <- paste0(\"out_\", str_to_lower(position))\n  formula_str <- paste0(\n    outcome_var, \" ~ theta + theta:move_left + theta:launch_speed + theta:launch_speed:move_left\"\n  )\n\n  # Pre bayesian model \n  model <- glm(\n    formula = as.formula(formula_str),\n    data = play_data,\n    family = binomial(link = \"probit\")\n  )\n  \n  return(model)\n  \n}\n```\n:::\n\n\n\n## Bayesian Structure\n\nThe existing model definitions and provide a hierarchical probit regression framework for estimating the probability of a successful play on a batted ball.\nHowever, for players with limited data, the estimates of the player-specific coefficients may be unreliable.\nTo address this, we introduce a Bayesian hierarchical structure that allows for the sharing of information across players at the same position.\n\nFor each position, we assume that the player-specific coefficients $\\beta_{ik}$ for player $i$ and covariate $k$ are drawn from a common normal distribution:\n\n$$\n\\mathbf{\\beta_{i}} \\sim \\text{Normal}(\\mathbf{\\mu}, \\Sigma)\n$$\nwhere $\\mu$ is a vector of position-specific mean coefficients and $\\Sigma$ is a covariance matrix that captures the variability of the coefficients across players at that position.\nWithin the covariance structure, we assume that all components of $\\beta_i$ are independent, leading to a diagonal covariance matrix where\n\n\n## References {.unnumbered}\n\n:::{#refs}\n\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}