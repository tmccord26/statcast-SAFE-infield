{
  "hash": "148ea3a50a788880b6e681ddaa32f759",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Modeling the Run Value of Ground Balls\"\nformat: html\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.2\n✔ ggplot2   4.0.0     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.1.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(mgcv)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nLoading required package: nlme\n\nAttaching package: 'nlme'\n\nThe following object is masked from 'package:dplyr':\n\n    collapse\n\nThis is mgcv 1.9-1. For overview type 'help(\"mgcv-package\")'.\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nbip_gb <- readRDS(\"statcast_data/bip_gb.rds\")\n```\n:::\n\n\n\n## Finding the Density of Ground Balls By Spray Angle for a Given Velocity\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nbip_gb |>\n  filter(launch_speed >= 95, launch_speed <= 100) |>\n  ggplot(aes(x = spray_angle)) +\n  geom_density(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](run_value_modeling_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(MASS)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n\nAttaching package: 'MASS'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nThe following object is masked from 'package:dplyr':\n\n    select\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nbip_gb_vel_95_100 <- bip_gb |>\n  filter(launch_speed >= 95, launch_speed <= 100)\nspray_angle_density_95_100 <- density(bip_gb_vel_95_100$spray_angle, from = -45, to = 45, n = 90)\nplot(spray_angle_density_95_100)\n```\n\n::: {.cell-output-display}\n![](run_value_modeling_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n## Linear Weights Modeling of Run Values\n\nWe want to estimate the run value of a ground ball based on its launch speed and spray angle. We can do this by fitting a linear model where the response variable is the run value of the play (based on the outcome) and the predictors are launch speed and spray angle.\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nggplot(bip_gb, aes(x = launch_speed, y = delta_run_exp, color = launch_angle)) +\n  geom_point(alpha = 0.3)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 901 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](run_value_modeling_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nmod_rv <- gam(delta_run_exp ~ s(launch_speed) + s(spray_angle) + launch_speed:spray_angle, data = bip_gb)\nsummary(mod_rv)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFamily: gaussian \nLink function: identity \n\nFormula:\ndelta_run_exp ~ s(launch_speed) + s(spray_angle) + launch_speed:spray_angle\n\nParametric coefficients:\n                           Estimate Std. Error t value Pr(>|t|)    \n(Intercept)              -6.123e-02  8.617e-04  -71.05   <2e-16 ***\nlaunch_speed:spray_angle  2.577e-05  1.937e-06   13.30   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nApproximate significance of smooth terms:\n                  edf Ref.df     F p-value    \ns(launch_speed) 8.126  8.695 894.1  <2e-16 ***\ns(spray_angle)  8.997  9.000 528.2  <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nR-sq.(adj) =  0.0817   Deviance explained = 8.18%\nGCV = 0.10162  Scale est. = 0.10161   n = 144169\n```\n\n\n:::\n:::\n\n\n## Apply These Run Value Estimates to the Ground Ball Dataset\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlaunch_speed_seq <- seq(50, 110, by = 1)\nspray_angle_seq <- seq(-45, 45, by = 1)\nnew_data <- expand.grid(\n  launch_speed = launch_speed_seq,\n  spray_angle = spray_angle_seq\n)\nnew_data$predicted_run_value <- predict(mod_rv, newdata = new_data)\n\nnew_data |>\n  filter(launch_speed == 100) |>\n  ggplot(aes(x = spray_angle, y = predicted_run_value)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](run_value_modeling_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n",
    "supporting": [
      "run_value_modeling_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}